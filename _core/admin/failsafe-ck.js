/*
 * @build  : 10 Aug, 2013
 * @author : Ram swaroop
 * @company: Compzets.com
 */(function(e){var t='<div class="fs-overlay" onclick="$.failsafe.putToTop();"></div><div class="fs-container" onclick="$.failsafe.putToTop();"><div class="fs-fig"></div></div>',n='<div class="bar bar-1"></div><div class="bar bar-2"></div><div class="bar bar-3"></div><div class="bar bar-4"></div><div class="bar bar-5"></div>',r='<div class="battery"><div class="battery-charge"></div></div><div class="battery-head"></div>',i='<div class="fs-sep"></div>',s="online",o="charging",u;e.extend({failsafe:function(t){var n=e.extend({},e.failsafe.defaults,t),r=function(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0);n.data=t;window.dispatchEvent(n)},i=function(e,t){var n;window.XMLHttpRequest?n=new XMLHttpRequest:n=new ActiveXObject("Microsoft.XMLHTTP");n.onreadystatechange=function(e){if(n.readyState!=4)return;n.status==200?r("goodconnection",{}):r("connectionerror",{})};n.open("GET",e+"?fs="+Math.random(),!0);n.send()};window.addEventListener("goodconnection",function(t){e.failsafe.onOnline(n)});window.addEventListener("connectionerror",function(t){e.failsafe.onOffline(n)});if(n.checkNet==1){i(n.checkUrl);setInterval(function(){i(n.checkUrl)},n.checkInterval)}if(n.checkBattery==1&&(u=navigator.battery||navigator.webkitBattery||navigator.mozBattery)){u.level<=n.chargeThreshold/100&&!u.charging&&e.failsafe.onBatteryLow(n);u.addEventListener("levelchange",function(){u.level<=n.chargeThreshold/100&&!u.charging&&e.failsafe.onBatteryLow(n)});u.addEventListener("chargingchange",function(){u.charging?e.failsafe.onCharging(n):u.level<=n.chargeThreshold/100&&e.failsafe.onBatteryLow(n)})}}});e.extend(e.failsafe,{init:function(n){e("body").prepend(t);n()},onOffline:function(t){if(s=="online"){s="offline";if(o=="batteryLow"){e(".fs-fig").append(i);e(".fs-fig").append(n);e(".bar").css("background-color","#F00");e(".fs-msg").text(t.bothDownMsg)}else e.failsafe.init(function(){e(".fs-fig").append(n);e(".bar").css("background-color","#F00");e(".fs-container").append("<div class='fs-msg'>"+t.offlineMsg+"</div>");e.failsafe.disableElements(t)})}},onOnline:function(t){if(s=="offline"){s="online";(e(".fs-overlay").length!=0||e(".fs-container").length!=0)&&e.failsafe.remove({removeDelay:0});e.failsafe.init(function(){e(".fs-fig").append(n);e(".fs-container").append("<div class='fs-msg'>"+t.onlineMsg+"</div>");e.failsafe.remove(t)});if(o=="batteryLow"){e.failsafe.init(function(){e(".fs-container").append("<div class='fs-msg'>"+t.batteryLowMsg+"</div>");e.failsafe.putToTop()});return}e.failsafe.enableElements(t)}},onBatteryLow:function(t){if(o=="charging"){o="batteryLow";if(s=="offline"){e(".fs-fig").append(i);e(".fs-fig").append(r);e(".fs-msg").text(t.bothDownMsg)}else e.failsafe.init(function(){e(".fs-fig").append(r);e(".fs-container").append("<div class='fs-msg'>"+t.batteryLowMsg+"</div>");e.failsafe.disableElements(t)});e(".battery-charge").animate({width:u.level*100+"%"});e(".battery").attr("title","Battery Level: "+u.level*100+"%")}},onCharging:function(t){if(o=="batteryLow"){o="charging";(e(".fs-overlay").length!=0||e(".fs-container").length!=0)&&e.failsafe.remove({removeDelay:0});e.failsafe.init(function(){e(".fs-fig").append(r);e(".fs-container").append("<div class='fs-msg'>"+t.chargingMsg+"</div>");e.failsafe.remove(t)});if(s=="offline"){e.failsafe.init(function(){e(".fs-container").append("<div class='fs-msg'>"+t.offlineMsg+"</div>");e.failsafe.putToTop()});return}e.failsafe.enableElements(t)}},enableElements:function(t){t.disableElements!=""&&e(t.disableElements).removeAttr("disabled")},disableElements:function(t){t.disableElements!=""&&e(t.disableElements).attr("disabled","disabled")},putToTop:function(){e(".fs-fig").remove();e(".fs-overlay").animate({height:"60px"},300);e(".fs-container").animate({marginTop:"0"},500)},remove:function(t){e(".fs-overlay").fadeOut(t.removeDelay).remove();e(".fs-container").fadeOut(t.removeDelay).remove()},defaults:{checkUrl:"",checkInterval:1e4,onlineMsg:"Great! You are now online",offlineMsg:"Oops! Server seems down. Please wait",chargingMsg:"Your battery is now charging, carry on with your work!",batteryLowMsg:"Battery is quite low to continue, please plug in your laptop!",bothDownMsg:"Both, your network as well as battery are down!",chargeThreshold:15,disableElements:"",checkNet:!0,checkBattery:!0,removeDelay:4e3}})})(jQuery);